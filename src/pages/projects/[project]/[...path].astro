---
import { getProxyTarget } from "@/config/proxyConfig";
import { proxyRequest } from "@/utils/proxy";

export const prerender = false;

const { project, path } = Astro.params;
const subPath = "/" + (path || "");

const target = getProxyTarget(project || "");

if (target) {
    const result = await proxyRequest(Astro.request, target, subPath);
    if (result.response) {
        return result.response;
    }
    return new Response(result.error, { status: 502 });
}

return Astro.redirect("/projects");
