---
import { getProxyTarget } from "@/config/proxyConfig";
import { proxyRequest } from "@/utils/proxy";

export const prerender = false;

const { project, path } = Astro.params;
const subPath = "/" + (path || "");

const target = getProxyTarget(project || "");

if (target) {
    const { env } = Astro.locals.runtime || {};
    const result = await proxyRequest(Astro.request, target, subPath, env);
    
    if (result.response) {
        return result.response;
    }
    
    return new Response(result.error, { 
        status: result.statusCode || 502,
        headers: {
            'Content-Type': 'text/plain; charset=utf-8'
        }
    });
}

return Astro.redirect("/projects");
