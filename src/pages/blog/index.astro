---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<BaseLayout
    title="博客"
    description="技术分享、开发心得、学习笔记 - ErpanOmer 的技术博客"
>
    <div class="max-w-3xl mx-auto px-4 sm:px-6 py-12 sm:py-20">
        <!-- Header -->
        <div class="mb-12">
            <a
                href="/"
                class="inline-flex items-center gap-2 text-sm text-zinc-500 hover:text-white mb-6 transition-colors"
            >
                <svg
                    class="w-4 h-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span>返回首页</span>
            </a>
            <h1 class="text-2xl sm:text-3xl font-bold text-white mb-3">博客</h1>
            <p class="text-base text-zinc-400">技术分享、开发心得、学习笔记</p>
        </div>

        <!-- Posts List -->
        <div class="space-y-8">
            {
                posts.map((post) => (
                    <a href={`/blog/${post.slug}`} class="group block">
                        <article class="flex flex-col sm:flex-row gap-4 sm:gap-6 p-4 -mx-4 rounded-xl hover:bg-zinc-900/50 transition-colors">
                            {post.data.cover && (
                                <div class="aspect-video flex-[0.5] flex-shrink-0 rounded-lg overflow-hidden bg-zinc-800">
                                    <img
                                        src={post.data.cover}
                                        alt={post.data.title}
                                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                    />
                                </div>
                            )}
                            <div class="flex-1 min-w-0">
                                <time
                                    class="text-sm text-zinc-500"
                                    datetime={post.data.pubDate.toISOString()}
                                >
                                    {post.data.pubDate.toLocaleDateString(
                                        "zh-CN",
                                        {
                                            year: "numeric",
                                            month: "short",
                                            day: "numeric",
                                        },
                                    )}
                                </time>
                                <h2 class="text-base sm:text-lg font-semibold text-white mt-1.5 mb-1.5 group-hover:text-indigo-400 transition-colors leading-snug">
                                    {post.data.title}
                                </h2>
                                <p class="text-sm text-zinc-400 line-clamp-2 leading-relaxed">
                                    {post.data.description}
                                </p>
                                {post.data.tags.length > 0 && (
                                    <div class="flex flex-wrap gap-1.5 mt-3">
                                        {post.data.tags
                                            .slice(0, 3)
                                            .map((tag) => (
                                                <span class="text-xs px-2 py-0.5 rounded-full bg-zinc-800 text-zinc-400">
                                                    {tag}
                                                </span>
                                            ))}
                                    </div>
                                )}
                            </div>
                        </article>
                    </a>
                ))
            }
        </div>

        {
            posts.length === 0 && (
                <div class="text-center py-16">
                    <p class="text-zinc-500">暂无文章</p>
                </div>
            )
        }
    </div>
</BaseLayout>
